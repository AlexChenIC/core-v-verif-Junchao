# CV32E40Pé¡¹ç›®ç¼–ç æ¨¡å¼æ·±åº¦åˆ†æ

> **åŸºäºå®é™…æºç çš„ç¼–ç è§„èŒƒå’Œè®¾è®¡æ¨¡å¼è§£æ**  
> é€‚åˆéœ€è¦ç†è§£é¡¹ç›®ä»£ç ç»“æ„ã€è´¡çŒ®ä»£ç æˆ–è¿›è¡Œå®šåˆ¶å¼€å‘çš„å·¥ç¨‹å¸ˆ

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®ç‰¹æœ‰çš„å‘½åä½“ç³»](#é¡¹ç›®ç‰¹æœ‰çš„å‘½åä½“ç³»)
- [ç›®å½•å±‚æ¬¡æ¶æ„åˆ†æ](#ç›®å½•å±‚æ¬¡æ¶æ„åˆ†æ)
- [æ–‡ä»¶ç»„ç»‡ç­–ç•¥](#æ–‡ä»¶ç»„ç»‡ç­–ç•¥)
- [SystemVerilogç¼–ç é£æ ¼](#systemverilogç¼–ç é£æ ¼)
- [UVMç»„ä»¶ç¼–ç è§„èŒƒ](#uvmç»„ä»¶ç¼–ç è§„èŒƒ)

---

## ğŸ·ï¸ é¡¹ç›®ç‰¹æœ‰çš„å‘½åä½“ç³»

### æ ¸å¿ƒå‘½åæ¨¡å¼è§£æ

åŸºäºå¯¹é¡¹ç›®å®é™…ä»£ç çš„åˆ†æï¼ŒCV32E40Pé‡‡ç”¨äº†ä¸¥æ ¼çš„å±‚æ¬¡åŒ–å‘½åçº¦å®šï¼š

```
å‘½åæ¨¡å¼ï¼š<å±‚æ¬¡å‰ç¼€>_<ç›®æ ‡æ ¸å¿ƒ>_<ç»„ä»¶ç±»å‹>_<å…·ä½“åŠŸèƒ½>

å®é™…ç¤ºä¾‹åˆ†æï¼š
â”œâ”€â”€ uvmt_cv32e40p_*     # Testbenchå±‚ (tb/uvmt/)
â”œâ”€â”€ uvme_cv32e40p_*     # Environmentå±‚ (env/uvme/)  
â”œâ”€â”€ uvma_*              # Agentå±‚ (lib/uvm_agents/)
â””â”€â”€ uvml_*              # Libraryå±‚ (lib/*)
```

#### 1. **Testbenchå±‚å‘½åæ¨¡å¼** (`uvmt_*`)

```systemverilog
// æ–‡ä»¶ï¼šcv32e40p/tb/uvmt/uvmt_cv32e40p_pkg.sv
package uvmt_cv32e40p_pkg;
   // uvmt = UVM Testbench
   // cv32e40p = ç›®æ ‡æ ¸å¿ƒæ ‡è¯†
   // pkg = åŒ…æ–‡ä»¶
```

**å®é™…æ–‡ä»¶ç¤ºä¾‹**ï¼š
- `uvmt_cv32e40p_tb.sv` - é¡¶å±‚æµ‹è¯•å°æ¨¡å—
- `uvmt_cv32e40p_pkg.sv` - æµ‹è¯•å°åŒ…å®šä¹‰
- `uvmt_cv32e40p_constants.sv` - æµ‹è¯•å°å¸¸é‡å®šä¹‰
- `uvmt_cv32e40p_dut_wrap.sv` - DUTåŒ…è£…å™¨

#### 2. **Environmentå±‚å‘½åæ¨¡å¼** (`uvme_*`)

```systemverilog
// æ–‡ä»¶ï¼šcv32e40p/env/uvme/uvme_cv32e40p_env.sv  
class uvme_cv32e40p_env_c extends uvm_env;
   // uvme = UVM Environment
   // cv32e40p = ç›®æ ‡æ ¸å¿ƒæ ‡è¯†  
   // env = ç¯å¢ƒç»„ä»¶
   // _c = ç±»åç¼€
```

**å±‚æ¬¡åŒ–ç»„ä»¶å‘½å**ï¼š
- `uvme_cv32e40p_env.sv` - ä¸»ç¯å¢ƒç±»
- `uvme_cv32e40p_cfg.sv` - ç¯å¢ƒé…ç½®ç±»  
- `uvme_cv32e40p_cntxt.sv` - ç¯å¢ƒä¸Šä¸‹æ–‡ç±»
- `uvme_cv32e40p_vsqr.sv` - è™šæ‹Ÿåºåˆ—å™¨

#### 3. **Agentå±‚å‘½åæ¨¡å¼** (`uvma_*`)

```systemverilog
// æ–‡ä»¶ï¼šlib/uvm_agents/uvma_core_cntrl/uvma_core_cntrl_agent.sv
virtual class uvma_core_cntrl_agent_c extends uvm_agent;
   // uvma = UVM Agent
   // core_cntrl = åŠŸèƒ½åŸŸæ ‡è¯†
   // agent = Agentç»„ä»¶
   // _c = ç±»åç¼€
```

**é€šç”¨Agentç»„ä»¶å‘½åè§„èŒƒ**ï¼š
```
uvma_<åŠŸèƒ½åŸŸ>_agent.sv      # Agentä¸»ç±»
uvma_<åŠŸèƒ½åŸŸ>_cfg.sv        # é…ç½®ç±»
uvma_<åŠŸèƒ½åŸŸ>_cntxt.sv      # ä¸Šä¸‹æ–‡ç±»
uvma_<åŠŸèƒ½åŸŸ>_drv.sv        # é©±åŠ¨å™¨
uvma_<åŠŸèƒ½åŸŸ>_mon.sv        # ç›‘æ§å™¨
uvma_<åŠŸèƒ½åŸŸ>_sqr.sv        # åºåˆ—å™¨
```

### æ¥å£å‘½åçº¦å®šåˆ†æ

é€šè¿‡åˆ†æé¡¹ç›®ä¸­çš„å®é™…æ¥å£å®šä¹‰ï¼š

```systemverilog
// æ–‡ä»¶ï¼šcv32e40p/tb/uvmt/uvmt_cv32e40p_tb_ifs.sv
uvma_clknrst_if     clknrst_if();           # æ—¶é’Ÿå¤ä½æ¥å£
uvma_debug_if       debug_if();             # è°ƒè¯•æ¥å£  
uvma_interrupt_if   interrupt_if();         # ä¸­æ–­æ¥å£
uvma_obi_memory_if  obi_memory_instr_if();  # OBIæŒ‡ä»¤å†…å­˜æ¥å£
uvma_obi_memory_if  obi_memory_data_if();   # OBIæ•°æ®å†…å­˜æ¥å£
```

**æ¥å£å‘½åè§„åˆ™**ï¼š
- æ¥å£ç±»å‹ï¼š`uvma_<åè®®>_if`
- æ¥å£å®ä¾‹ï¼š`<åŠŸèƒ½æè¿°>_if`
- å¤åˆæ¥å£ï¼š`<åè®®>_<æ•°æ®ç±»å‹>_if`

---

## ğŸ—‚ï¸ ç›®å½•å±‚æ¬¡æ¶æ„åˆ†æ

### é¡¹ç›®ç›®å½•çš„è®¾è®¡å“²å­¦

åŸºäºå®é™…ç›®å½•ç»“æ„åˆ†æï¼Œé¡¹ç›®é‡‡ç”¨**åŠŸèƒ½åˆ†å±‚ + å¤ç”¨å¯¼å‘**çš„ç»„ç»‡ç­–ç•¥ï¼š

```
core-v-verif/
â”œâ”€â”€ cv32e40p/                    # æ ¸å¿ƒç‰¹å®šä»£ç 
â”‚   â”œâ”€â”€ tb/uvmt/                 # æµ‹è¯•å°å±‚ (Testbench)
â”‚   â”‚   â”œâ”€â”€ uvmt_cv32e40p_pkg.sv      # ä¸»åŒ…æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ uvmt_cv32e40p_tb.sv       # é¡¶å±‚æµ‹è¯•å°  
â”‚   â”‚   â””â”€â”€ uvmt_cv32e40p_*.sv        # æµ‹è¯•å°ç›¸å…³æ¨¡å—
â”‚   â”œâ”€â”€ env/uvme/                # ç¯å¢ƒå±‚ (Environment)  
â”‚   â”‚   â”œâ”€â”€ uvme_cv32e40p_env.sv      # ä¸»ç¯å¢ƒç±»
â”‚   â”‚   â””â”€â”€ vseq/                     # è™šæ‹Ÿåºåˆ—é›†åˆ
â”‚   â””â”€â”€ tests/uvmt/              # æµ‹è¯•ç”¨ä¾‹å±‚
â”‚       â”œâ”€â”€ base-tests/               # åŸºç¡€æµ‹è¯•ç±»
â”‚       â””â”€â”€ compliance-tests/         # åˆè§„æµ‹è¯•
â”œâ”€â”€ lib/                         # é€šç”¨åº“ (å¯å¤ç”¨ç»„ä»¶)
â”‚   â”œâ”€â”€ uvm_agents/              # Agentåº“
â”‚   â”œâ”€â”€ uvm_libs/                # åŸºç¡€åº“
â”‚   â””â”€â”€ uvm_objs/                # é€šç”¨å¯¹è±¡
â””â”€â”€ mk/                          # æ„å»ºç³»ç»Ÿ
    â””â”€â”€ uvmt/                    # UVMæµ‹è¯•å°æ„å»ºè§„åˆ™
```

### åˆ†å±‚è®¾è®¡åŸåˆ™åˆ†æ

#### 1. **æ ¸å¿ƒç‰¹å®šå±‚** (`cv32e40p/`)

```bash
# å®é™…æ–‡ä»¶ç»Ÿè®¡åˆ†æ
$ find cv32e40p -name "*.sv" | wc -l
# çº¦200+ä¸ªæ–‡ä»¶ï¼Œå…¨éƒ¨é’ˆå¯¹CV32E40Pæ ¸å¿ƒå®šåˆ¶

# æ–‡ä»¶åˆ†å¸ƒï¼š
$ find cv32e40p -name "*.sv" | cut -d'/' -f2 | sort | uniq -c
#     145 tb       # æµ‹è¯•å°å®ç°
#      28 env      # ç¯å¢ƒå®ç°  
#      35 tests    # æµ‹è¯•ç”¨ä¾‹
```

**æ ¸å¿ƒç‰¹å®šå±‚çš„èŒè´£**ï¼š
- CV32E40På¤„ç†å™¨çš„ä¸“ç”¨éªŒè¯é€»è¾‘
- ä¸æ ¸å¿ƒæ¶æ„ç´§å¯†ç›¸å…³çš„æµ‹è¯•å°å®ç°
- æ ¸å¿ƒç‰¹æœ‰çš„æµ‹è¯•ç”¨ä¾‹å’Œåºåˆ—

#### 2. **é€šç”¨åº“å±‚** (`lib/`)

```bash
# Agentåº“çš„å®é™…ç»„ç»‡
$ ls lib/uvm_agents/
uvma_axi/           # AXIåè®®Agent
uvma_clknrst/       # æ—¶é’Ÿå¤ä½Agent  
uvma_core_cntrl/    # æ ¸å¿ƒæ§åˆ¶Agent
uvma_debug/         # è°ƒè¯•Agent
uvma_interrupt/     # ä¸­æ–­Agent
uvma_obi_memory/    # OBIå†…å­˜Agent
uvma_reset/         # å¤ä½Agent
... (çº¦15ä¸ªAgent)
```

**é€šç”¨åº“çš„å¤ç”¨ç­–ç•¥**ï¼š
- åè®®æ ‡å‡†åŒ–å®ç°ï¼ˆAXI, OBIç­‰ï¼‰
- è·¨é¡¹ç›®å¯å¤ç”¨çš„éªŒè¯ç»„ä»¶
- æ ‡å‡†æ¥å£çš„æŠ½è±¡å°è£…

---

## ğŸ“„ æ–‡ä»¶ç»„ç»‡ç­–ç•¥

### flistæ–‡ä»¶çš„ç»„ç»‡æ¨¡å¼

é€šè¿‡åˆ†æ`uvmt_cv32e40p.flist`ï¼Œæ­ç¤ºé¡¹ç›®çš„ä¾èµ–ç®¡ç†ç­–ç•¥ï¼š

```bash
# æ–‡ä»¶ï¼šcv32e40p/tb/uvmt/uvmt_cv32e40p.flist

// ğŸ”¹ ç¬¬1å±‚ï¼šåŸºç¡€åº“ä¾èµ–
-f ${DV_UVML_HRTBT_PATH}/uvml_hrtbt_pkg.flist      # å¿ƒè·³åº“
-f ${DV_UVML_TRN_PATH}/uvml_trn_pkg.flist          # äº‹åŠ¡åº“
-f ${DV_UVML_LOGS_PATH}/uvml_logs_pkg.flist        # æ—¥å¿—åº“
-f ${DV_UVML_SB_PATH}/uvml_sb_pkg.flist            # è®°åˆ†æ¿åº“

// ğŸ”¹ ç¬¬2å±‚ï¼šAgentä¾èµ–  
-f ${DV_UVMA_CLKNRST_PATH}/uvma_clknrst_pkg.flist      # æ—¶é’Ÿå¤ä½Agent
-f ${DV_UVMA_INTERRUPT_PATH}/uvma_interrupt_pkg.flist   # ä¸­æ–­Agent
-f ${DV_UVMA_OBI_MEMORY_PATH}/src/uvma_obi_memory_pkg.flist # OBIå†…å­˜Agent
-f ${DV_UVMA_DEBUG_PATH}/uvma_debug_pkg.flist           # è°ƒè¯•Agent

// ğŸ”¹ ç¬¬3å±‚ï¼šç¯å¢ƒä¾èµ–
-f ${CV32E40P_DV_HOME}/env/uvme/uvme_cv32e40p.flist    # CV32E40Pç¯å¢ƒ

// ğŸ”¹ ç¬¬4å±‚ï¼šæµ‹è¯•å°å®ç°
${CV32E40P_DV_HOME}/tb/uvmt/uvmt_cv32e40p_pkg.sv       # æµ‹è¯•å°åŒ…
```

**ä¾èµ–å±‚æ¬¡åˆ†æ**ï¼š
1. **åŸºç¡€è®¾æ–½å±‚**ï¼šæä¾›é€šç”¨åŠŸèƒ½ï¼ˆå¿ƒè·³ã€æ—¥å¿—ã€äº‹åŠ¡å¤„ç†ï¼‰
2. **æ¥å£æŠ½è±¡å±‚**ï¼šæ ‡å‡†åè®®çš„Agentå®ç°  
3. **ç¯å¢ƒé›†æˆå±‚**ï¼šå°†Agentç»„è£…æˆå®Œæ•´ç¯å¢ƒ
4. **æµ‹è¯•å°å®ç°å±‚**ï¼šå…·ä½“çš„æµ‹è¯•å°é€»è¾‘

### åŒ…æ–‡ä»¶çš„å†…éƒ¨ç»„ç»‡

```systemverilog
// æ–‡ä»¶ï¼šcv32e40p/tb/uvmt/uvmt_cv32e40p_pkg.sv

package uvmt_cv32e40p_pkg;
   
   // ğŸ”¹ ç¬¬1æ­¥ï¼šå¯¼å…¥ä¾èµ–åŒ…
   import uvm_pkg::*;
   import uvme_cv32e40p_pkg::*;      # ç¯å¢ƒåŒ…
   import uvml_hrtbt_pkg::*;         # å¿ƒè·³åŒ…
   import uvml_logs_pkg::*;          # æ—¥å¿—åŒ…
   
   // ğŸ”¹ ç¬¬2æ­¥ï¼šåŒ…å«å®å®šä¹‰
   `include "uvm_macros.svh"
   `include "uvmt_cv32e40p_macros.sv"
   
   // ğŸ”¹ ç¬¬3æ­¥ï¼šåŒ…å«ç±»å‹å®šä¹‰
   `include "uvmt_cv32e40p_constants.sv"    # å¸¸é‡å®šä¹‰
   `include "uvmt_cv32e40p_tdefs.sv"        # ç±»å‹å®šä¹‰
   
   // ğŸ”¹ ç¬¬4æ­¥ï¼šåŒ…å«å®ç°æ–‡ä»¶
   `include "uvmt_cv32e40p_vseq_lib.sv"     # è™šæ‹Ÿåºåˆ—åº“
   `include "uvmt_cv32e40p_base_test.sv"    # åŸºç¡€æµ‹è¯•ç±»
   ...
endpackage
```

**åŒ…ç»„ç»‡åŸåˆ™**ï¼š
1. **ä¾èµ–ä¼˜å…ˆ**ï¼šå…ˆå¯¼å…¥æ‰€æœ‰ä¾èµ–åŒ…
2. **å®å®šä¹‰æ¬¡ä¹‹**ï¼šç¡®ä¿å®åœ¨ä½¿ç”¨å‰å®šä¹‰
3. **ç±»å‹å®šä¹‰ç¬¬ä¸‰**ï¼šå¸¸é‡å’Œç±»å‹å®šä¹‰
4. **å®ç°æ–‡ä»¶æœ€å**ï¼šå…·ä½“çš„ç±»å®ç°

---

## ğŸ¨ SystemVerilogç¼–ç é£æ ¼

### ä»£ç æ ¼å¼åŒ–æ ‡å‡†

é€šè¿‡åˆ†æå¤šä¸ªæºæ–‡ä»¶ï¼Œæ€»ç»“å‡ºé¡¹ç›®çš„æ ¼å¼åŒ–çº¦å®šï¼š

#### 1. **ç±»å®šä¹‰æ ¼å¼**

```systemverilog
// å®é™…ç¤ºä¾‹ï¼šlib/uvm_agents/uvma_core_cntrl/uvma_core_cntrl_agent.sv

/**
 * ğŸ“ æ³¨é‡Šå—æ ¼å¼ï¼šä½¿ç”¨/** */å¤šè¡Œæ³¨é‡Š
 * Virtual base class agent for Core Control
 * Encapsulates:
 * - Parameter sampling  
 * - Bootstrap pin randomization and driving
 * - Core configuration and randomization
 */
virtual class uvma_core_cntrl_agent_c extends uvm_agent;
   
   // ğŸ”¹ å­—æ®µå£°æ˜åŒºåŸŸ
   // Objects
   uvma_core_cntrl_cfg_c    cfg;        # 4ç©ºæ ¼ç¼©è¿›
   uvma_core_cntrl_cntxt_c  cntxt;      # å¯¹é½å£°æ˜
   
   // Components   
   uvma_core_cntrl_sqr_c    sequencer;  # æŒ‰åŠŸèƒ½åˆ†ç»„
   uvma_core_cntrl_drv_c    driver;     # æ³¨é‡Šå¯¹é½
   
   // ğŸ”¹ UVMå®ä½¿ç”¨
   `uvm_field_utils_begin(uvma_core_cntrl_agent_c)
      `uvm_field_object(cfg  , UVM_DEFAULT)     # å®å†…ç¼©è¿›3ç©ºæ ¼
      `uvm_field_object(cntxt, UVM_DEFAULT)
   `uvm_field_utils_end
```

#### 2. **å‡½æ•°/ä»»åŠ¡æ ¼å¼**

```systemverilog
/**
 * ğŸ“ å‡½æ•°æ³¨é‡Šï¼šæè¿°åŠŸèƒ½å’Œå‚æ•°
 * Default constructor.
 */
extern function new(string name="uvma_core_cntrl_agent", uvm_component parent=null);

/**
 * ğŸ”§ Build phase implementation
 * Creates sub-components based on configuration
 */
virtual function void build_phase(uvm_phase phase);
   super.build_phase(phase);                    # å…ˆè°ƒç”¨çˆ¶ç±»æ–¹æ³•
   
   // ğŸ”¹ æ¡ä»¶ç¼–è¯‘ä½¿ç”¨4ç©ºæ ¼ç¼©è¿›
   if (cfg.enabled) begin
      if (cfg.is_active) begin                  # åµŒå¥—æ¡ä»¶å¯¹é½
         sequencer = uvma_core_cntrl_sqr_c::type_id::create("sequencer", this);
         driver    = uvma_core_cntrl_drv_c::type_id::create("driver"   , this);
      end
   end
endfunction
```

### å‚æ•°åŒ–è®¾è®¡æ¨¡å¼

é¡¹ç›®ä¸­å¹¿æ³›ä½¿ç”¨å‚æ•°åŒ–æ¥æé«˜ä»£ç å¤ç”¨æ€§ï¼š

```systemverilog
// æ–‡ä»¶ï¼šcv32e40p/tb/uvmt/uvmt_cv32e40p_constants.sv

// ğŸ”¹ å¤„ç†å™¨å‚æ•°å®šä¹‰
`ifdef NO_PULP
   parameter int CORE_PARAM_PULP_XPULP       = 0;     # æ¡ä»¶å‚æ•°
   parameter int CORE_PARAM_PULP_CLUSTER     = 0;     # å¯¹é½èµ‹å€¼
   parameter int CORE_PARAM_PULP_ZFINX       = 0;
`else
   `ifdef PULP
      parameter int CORE_PARAM_PULP_XPULP       = 1;  # åµŒå¥—æ¡ä»¶
      parameter int CORE_PARAM_PULP_CLUSTER     = 0;
      parameter int CORE_PARAM_PULP_ZFINX       = 0;
   `endif
`endif

// ğŸ”¹ å†…å­˜å’Œåœ°å€å‚æ•°
parameter int ENV_PARAM_INSTR_ADDR_WIDTH  = 32;       # ç¯å¢ƒå‚æ•°å‰ç¼€
parameter int ENV_PARAM_INSTR_DATA_WIDTH  = 32;
parameter int ENV_PARAM_RAM_ADDR_WIDTH    = 22;
```

---

## ğŸ—ï¸ UVMç»„ä»¶ç¼–ç è§„èŒƒ

### ç»„ä»¶å±‚æ¬¡ç»“æ„ç¼–ç æ¨¡å¼

é€šè¿‡åˆ†æç¯å¢ƒç±»çš„å®é™…å®ç°ï¼Œäº†è§£UVMç»„ä»¶çš„ç¼–ç è§„èŒƒï¼š

```systemverilog
// æ–‡ä»¶ï¼šcv32e40p/env/uvme/uvme_cv32e40p_env.sv (ç®€åŒ–ç¤ºä¾‹)

class uvme_cv32e40p_env_c extends uvm_env;
   
   // ğŸ”¹ é…ç½®å¯¹è±¡ (å¿…é¡»åœ¨æœ€å‰é¢)
   uvme_cv32e40p_cfg_c    cfg;
   uvme_cv32e40p_cntxt_c  cntxt;
   
   // ğŸ”¹ Agentå®ä¾‹ (æŒ‰åŠŸèƒ½åŸŸåˆ†ç»„)
   // Clock/Reset
   uvma_clknrst_agent_c             clknrst_agent;
   
   // Debug and Control  
   uvma_debug_agent_c               debug_agent;
   uvma_core_cntrl_agent_c          core_cntrl_agent;
   
   // Memory Interfaces
   uvma_obi_memory_agent_c          obi_memory_instr_agent;
   uvma_obi_memory_agent_c          obi_memory_data_agent;
   
   // Interrupts
   uvma_interrupt_agent_c           interrupt_agent;
   
   // ğŸ”¹ é¢„æµ‹å™¨å’Œè®°åˆ†æ¿
   uvme_cv32e40p_prd_c              predictor;
   uvme_cv32e40p_sb_c               sb;
   
   // ğŸ”¹ è™šæ‹Ÿåºåˆ—å™¨
   uvme_cv32e40p_vsqr_c             vsequencer;
   
   `uvm_component_utils_begin(uvme_cv32e40p_env_c)
      `uvm_field_object(cfg  , UVM_DEFAULT)
      `uvm_field_object(cntxt, UVM_DEFAULT)
   `uvm_component_utils_end
```

### Phaseç¼–ç è§„èŒƒ

é¡¹ç›®ä¸­Phaseçš„æ ‡å‡†å®ç°æ¨¡å¼ï¼š

```systemverilog
/**
 * ğŸ—ï¸ Build Phase: ç»„ä»¶åˆ›å»ºå’Œé…ç½®
 */
virtual function void build_phase(uvm_phase phase);
   super.build_phase(phase);
   
   // ğŸ”¹ ç¬¬1æ­¥ï¼šè·å–é…ç½®
   void'(uvm_config_db#(uvme_cv32e40p_cfg_c)::get(this, "", "cfg", cfg));
   if (!cfg) begin
      `uvm_fatal("ENV", "Configuration not found")
   end
   
   // ğŸ”¹ ç¬¬2æ­¥ï¼šè®¾ç½®ä¸Šä¸‹æ–‡
   uvm_config_db#(uvme_cv32e40p_cntxt_c)::set(this, "*", "cntxt", cntxt);
   
   // ğŸ”¹ ç¬¬3æ­¥ï¼šåˆ›å»ºAgent (æ¡ä»¶åˆ›å»º)
   if (cfg.enabled) begin
      // Clock/Reset Agent
      clknrst_agent = uvma_clknrst_agent_c::type_id::create("clknrst_agent", this);
      uvm_config_db#(uvma_clknrst_cfg_c)::set(this, "clknrst_agent", "cfg", cfg.clknrst_cfg);
      
      // Memory Agents  
      obi_memory_instr_agent = uvma_obi_memory_agent_c::type_id::create("obi_memory_instr_agent", this);
      uvm_config_db#(uvma_obi_memory_cfg_c)::set(this, "obi_memory_instr_agent", "cfg", cfg.obi_memory_instr_cfg);
   end
endfunction

/**  
 * ğŸ”— Connect Phase: ç»„ä»¶è¿æ¥
 */
virtual function void connect_phase(uvm_phase phase);
   super.connect_phase(phase);
   
   // ğŸ”¹ è¿æ¥é¢„æµ‹å™¨
   if (predictor) begin
      obi_memory_instr_agent.monitor.ap.connect(predictor.obi_memory_instr_export);
      obi_memory_data_agent.monitor.ap.connect(predictor.obi_memory_data_export);
   end
   
   // ğŸ”¹ è¿æ¥è®°åˆ†æ¿
   if (sb) begin
      predictor.obi_memory_instr_ap.connect(sb.obi_memory_instr_export);
      predictor.obi_memory_data_ap.connect(sb.obi_memory_data_export);
   end
endfunction
```

### é…ç½®å¯¹è±¡ç¼–ç æ¨¡å¼

```systemverilog
// é…ç½®ç±»çš„æ ‡å‡†ç»“æ„
class uvme_cv32e40p_cfg_c extends uvm_object;
   
   // ğŸ”¹ åŠŸèƒ½ä½¿èƒ½æ ‡å¿—
   bit                      enabled;
   bit                      is_active;
   
   // ğŸ”¹ å­Agenté…ç½®
   uvma_clknrst_cfg_c       clknrst_cfg;
   uvma_debug_cfg_c         debug_cfg;
   uvma_obi_memory_cfg_c    obi_memory_instr_cfg;
   uvma_obi_memory_cfg_c    obi_memory_data_cfg;
   
   // ğŸ”¹ æµ‹è¯•å°ç‰¹å®šé…ç½®
   uvmt_cv32e40p_tb_cfg_c   tb_cfg;
   
   `uvm_object_utils_begin(uvme_cv32e40p_cfg_c)
      `uvm_field_int (enabled            , UVM_DEFAULT)
      `uvm_field_int (is_active          , UVM_DEFAULT) 
      `uvm_field_object(clknrst_cfg       , UVM_DEFAULT)
      `uvm_field_object(debug_cfg         , UVM_DEFAULT)
   `uvm_object_utils_end
   
   /**
    * ğŸ›ï¸ é…ç½®çº¦æŸï¼šç¡®ä¿é…ç½®çš„ä¸€è‡´æ€§
    */
   constraint defaults_cons {
      enabled == 1;                          # é»˜è®¤ä½¿èƒ½
      is_active == 1;                        # é»˜è®¤æ¿€æ´»æ¨¡å¼
      
      // ğŸ”¹ å­é…ç½®ä¸€è‡´æ€§çº¦æŸ
      if (enabled) {
         clknrst_cfg.enabled == 1;
         debug_cfg.enabled == 1;
      }
   }
```

---

## ğŸ“š ç¼–ç è§„èŒƒæ€»ç»“

### å…³é”®ç¼–ç åŸåˆ™

1. **ğŸ“› å‘½åä¸€è‡´æ€§**ï¼šä¸¥æ ¼éµå¾ªå±‚æ¬¡åŒ–å‘½åçº¦å®š
2. **ğŸ“‚ æ–‡ä»¶ç»„ç»‡æ€§**ï¼šæŒ‰åŠŸèƒ½åŸŸå’Œå¤ç”¨çº§åˆ«ç»„ç»‡ä»£ç   
3. **ğŸ¨ æ ¼å¼è§„èŒƒæ€§**ï¼šç»Ÿä¸€çš„ç¼©è¿›ã€å¯¹é½å’Œæ³¨é‡Šé£æ ¼
4. **ğŸ”§ å‚æ•°åŒ–è®¾è®¡**ï¼šé€šè¿‡æ¡ä»¶ç¼–è¯‘å’Œå‚æ•°åŒ–æé«˜å¤ç”¨æ€§
5. **ğŸ—ï¸ UVMæ ‡å‡†æ€§**ï¼šä¸¥æ ¼éµå¾ªUVMç¼–ç å’ŒPhaseè§„èŒƒ

### æœ€ä½³å®è·µå»ºè®®

- **æ–°å¢ç»„ä»¶æ—¶**ï¼šå‚è€ƒç°æœ‰Agentçš„å®ç°æ¨¡å¼
- **ä¿®æ”¹é…ç½®æ—¶**ï¼šä¿æŒçº¦æŸçš„ä¸€è‡´æ€§æ£€æŸ¥
- **æ‰©å±•åŠŸèƒ½æ—¶**ï¼šéµå¾ªç°æœ‰çš„å±‚æ¬¡åŒ–è®¾è®¡
- **è°ƒè¯•ä»£ç æ—¶**ï¼šåˆ©ç”¨ç»Ÿä¸€çš„æ—¥å¿—å’Œè·Ÿè¸ªæœºåˆ¶

---

> ğŸ’¡ **å®è·µå»ºè®®**  
> åœ¨å®é™…å¼€å‘ä¸­ï¼Œå»ºè®®é¦–å…ˆé˜…è¯»ç›¸å…³çš„Agentå®ç°ä»£ç ï¼Œç†è§£å…¶ç»„ä»¶ç»„ç»‡å’Œæ¥å£è®¾è®¡ï¼Œç„¶åæŒ‰ç…§ç›¸åŒçš„æ¨¡å¼è¿›è¡Œæ‰©å±•æˆ–ä¿®æ”¹ã€‚é¡¹ç›®çš„ç¼–ç è§„èŒƒä¸ä»…ä¿è¯äº†ä»£ç è´¨é‡ï¼Œä¹Ÿæé«˜äº†å›¢é˜Ÿåä½œçš„æ•ˆç‡ã€‚