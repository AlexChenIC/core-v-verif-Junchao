# CV32E40P æµ‹è¯•æ‰§è¡Œè¯¦ç»†æŒ‡å— ğŸ“š

## æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è§£é‡Šäº†åœ¨CV32E40PéªŒè¯ç¯å¢ƒä¸­æ‰§è¡Œ `make test TEST=hello-world` å‘½ä»¤åï¼Œæ•´ä¸ªç³»ç»Ÿçš„æ¯ä¸€æ­¥æ‰§è¡Œæµç¨‹ã€‚

### ğŸ¯ ç›®æ ‡è¯»è€…
- å…·æœ‰UVMåŸºç¡€ç»éªŒçš„éªŒè¯å·¥ç¨‹å¸ˆ
- äº†è§£SoCè®¾è®¡çš„ç¡¬ä»¶å·¥ç¨‹å¸ˆ  
- ç†Ÿæ‚‰xrunä»¿çœŸå™¨çš„å·¥ç¨‹å¸ˆ
- å¯¹RISC-Vå¤„ç†å™¨éªŒè¯æ„Ÿå…´è¶£çš„åˆå­¦è€…

### ğŸ” ä½ å°†å­¦åˆ°ä»€ä¹ˆ
- å®Œæ•´çš„éªŒè¯æµç¨‹ï¼šä»Makefileåˆ°æœ€ç»ˆæµ‹è¯•æŠ¥å‘Š
- UVMæµ‹è¯•å°çš„å·¥ä½œåŸç†å’Œç»„ä»¶åè°ƒ
- è½¯ç¡¬ä»¶ååŒéªŒè¯çš„å®ç°æœºåˆ¶
- step-and-compareéªŒè¯æ–¹æ³•å­¦
- å®é™…çš„è°ƒè¯•æŠ€å·§å’Œé—®é¢˜æ’æŸ¥æ–¹æ³•

> ğŸ’¡ **ç±»æ¯”ç†è§£**: å¦‚æœæŠŠå¤„ç†å™¨éªŒè¯æ¯”ä½œå·¥å‚è´¨æ£€ï¼Œé‚£ä¹ˆè¿™ä¸ªæŒ‡å—å°±æ˜¯è¯¦ç»†çš„è´¨æ£€æ‰‹å†Œâ€”â€”å‘Šè¯‰ä½ æ¯ä¸ªæ£€éªŒæ­¥éª¤çš„åŸç†ã€å·¥å…·ä½¿ç”¨æ–¹æ³•ï¼Œä»¥åŠå¦‚ä½•ç¡®ä¿äº§å“è´¨é‡ã€‚

## ğŸ”§ ç¯å¢ƒå‡†å¤‡å’Œå‰ç½®æ¡ä»¶

### åŸºæœ¬ç¯å¢ƒè®¾ç½®

åœ¨æ‰§è¡Œæµ‹è¯•å‰ï¼Œå¿…é¡»è®¾ç½®ä»¥ä¸‹å…³é”®ç¯å¢ƒå˜é‡ï¼š

```bash
# âœ¨ ä»¿çœŸå™¨é€‰æ‹©ï¼šå‘Šè¯‰ç³»ç»Ÿä½¿ç”¨å“ªä¸ªä»¿çœŸå·¥å…·
export CV_SIMULATOR=xrun                    # Cadence Xcelium (é«˜æ€§èƒ½ä¸“ä¸šä»¿çœŸå™¨)

# ğŸ¯ ç›®æ ‡æ ¸å¿ƒï¼šæŒ‡å®šè¦éªŒè¯çš„å¤„ç†å™¨å‹å·  
export CV_CORE=cv32e40p                     # OpenHWçš„RISC-Væ ¸å¿ƒ

# ğŸ”§ å·¥å…·é“¾è·¯å¾„ï¼šç¼–è¯‘å™¨å’Œå·¥å…·çš„å®‰è£…ä½ç½®
export CV_SW_TOOLCHAIN=/opt/riscv           # RISC-V GCCå·¥å…·é“¾æ ¹ç›®å½•

# ğŸ·ï¸ å·¥å…·é“¾å‰ç¼€ï¼šç¼–è¯‘å™¨å¯æ‰§è¡Œæ–‡ä»¶çš„å‘½åå‰ç¼€
export CV_SW_PREFIX=riscv32-unknown-elf-    # 32ä½RISC-Vç¼–è¯‘å™¨å‰ç¼€
```

### ğŸ“ è‡ªæ£€æ¸…å•

åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·ç¡®è®¤ï¼š
- [ ] Cadence Xceliumå·²æ­£ç¡®å®‰è£…ä¸”å¯è®¿é—®
- [ ] RISC-Vå·¥å…·é“¾å·²å®‰è£…åœ¨`/opt/riscv`
- [ ] ç¯å¢ƒå˜é‡å·²æ­£ç¡®è®¾ç½®ï¼ˆå¯ç”¨`make vars`æ£€æŸ¥ï¼‰
- [ ] æœ‰è¯»å†™é¡¹ç›®ç›®å½•çš„æƒé™

> ğŸ’¡ **ç±»æ¯”ç†è§£**: è¿™äº›ç¯å¢ƒå˜é‡å°±åƒæ˜¯å‘Šè¯‰å·¥å‚æœºå™¨äººä½¿ç”¨å“ªä¸ªå·¥å…·ã€åœ¨å“ªé‡Œæ‰¾é›¶ä»¶ã€æ€ä¹ˆç»„è£…äº§å“ã€‚æ²¡æœ‰è¿™äº›ä¿¡æ¯ï¼Œæœºå™¨äººå°±ä¸çŸ¥é“è¯¥åšä»€ä¹ˆã€‚

## ç›®å½•ç»“æ„

```
core-v-verif/
â”œâ”€â”€ cv32e40p/
â”‚   â”œâ”€â”€ sim/uvmt/                          # UVMæµ‹è¯•å°ä»¿çœŸç›®å½•
â”‚   â”‚   â”œâ”€â”€ Makefile                       # ä¸»Makefile
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”œâ”€â”€ tb/uvmt/                           # UVMæµ‹è¯•å°SystemVerilogæºç 
â”‚   â”‚   â”œâ”€â”€ uvmt_cv32e40p_tb.sv           # é¡¶å±‚æµ‹è¯•å°
â”‚   â”‚   â”œâ”€â”€ uvmt_cv32e40p_pkg.sv          # UVMåŒ…å®šä¹‰
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ tests/programs/custom/hello-world/ # æµ‹è¯•ç¨‹åºç›®å½•
â”‚       â”œâ”€â”€ hello-world.c                  # Cæºç¨‹åº
â”‚       â””â”€â”€ test.yaml                      # æµ‹è¯•é…ç½®
â”œâ”€â”€ mk/                                    # é€šç”¨Makefileæ–‡ä»¶
â”‚   â”œâ”€â”€ uvmt/                              # UVMæµ‹è¯•å°ç›¸å…³Makefile
â”‚   â”‚   â”œâ”€â”€ uvmt.mk                        # é€šç”¨UVMæµ‹è¯•å°Makefile
â”‚   â”‚   â”œâ”€â”€ xrun.mk                        # Cadence Xceliumç‰¹å®šMakefile
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ Common.mk                          # é€šç”¨å®šä¹‰å’Œè§„åˆ™
â””â”€â”€ lib/                                   # é€šç”¨éªŒè¯ç»„ä»¶åº“
```

## å®Œæ•´æ‰§è¡Œæµç¨‹è¯¦è§£

### ç¬¬1æ­¥ï¼šMakefileè§£æå’Œç¯å¢ƒæ£€æŸ¥

**ä½ç½®**: `cv32e40p/sim/uvmt/Makefile`

**æ‰§è¡Œæµç¨‹**:
```makefile
# è®¾ç½®æ ¸å¿ƒå˜é‡
MAKE_PATH := $(shell dirname $(realpath $(lastword $(MAKEFILE_LIST))))
export CORE_V_VERIF = $(abspath $(MAKE_PATH)/../../..)
export CV_CORE ?= cv32e40p

# åŒ…å«å¤–éƒ¨ä»“åº“é…ç½®
include ../ExternalRepos.mk
# åŒ…å«ä¸»è¦çš„UVMæµ‹è¯•å°Makefile
include $(CORE_V_VERIF)/mk/uvmt/uvmt.mk
```

**ç›®çš„**: 
- ç¡®å®šé¡¹ç›®æ ¹ç›®å½•è·¯å¾„
- è®¾ç½®æ ¸å¿ƒå˜é‡ï¼ˆCV_COREç­‰ï¼‰
- åŠ è½½å¤–éƒ¨ä¾èµ–é…ç½®ï¼ˆRTLä»“åº“ã€ç¬¬ä¸‰æ–¹å·¥å…·ç­‰ï¼‰
- åŒ…å«ä¸»è¦çš„æµ‹è¯•é€»è¾‘

### ç¬¬2æ­¥ï¼šUVMæµ‹è¯•å°MakefileåŠ è½½

**ä½ç½®**: `mk/uvmt/uvmt.mk`

**æ‰§è¡Œæµç¨‹**:
```makefile
# æ£€æŸ¥å¿…éœ€çš„ç¯å¢ƒå˜é‡
ifndef CV_CORE
$(error Must set CV_CORE to a valid core)
endif

# è½¬æ¢ä¸ºå¤§å°å†™å˜é‡
CV_CORE_LC = $(shell echo $(CV_CORE) | tr A-Z a-z)
CV_CORE_UC = $(shell echo $(CV_CORE) | tr a-z A-Z)

# è®¾ç½®ä»¿çœŸå™¨
CV_SIMULATOR ?= unsim
SIMULATOR ?= $(CV_SIMULATOR)

# åŒ…å«é€šç”¨å®šä¹‰
include $(CORE_V_VERIF)/mk/Common.mk
```

**ç›®çš„**:
- éªŒè¯ç¯å¢ƒå˜é‡è®¾ç½®
- æ ‡å‡†åŒ–å˜é‡åç§°ï¼ˆå¤§å°å†™è½¬æ¢ï¼‰
- ç¡®å®šä½¿ç”¨çš„ä»¿çœŸå™¨ç±»å‹
- åŠ è½½é€šç”¨çš„ç¼–è¯‘å’Œé“¾æ¥è§„åˆ™

### ç¬¬3æ­¥ï¼šä»¿çœŸå™¨ç‰¹å®šMakefileåŠ è½½

**ä½ç½®**: `mk/uvmt/xrun.mk` ï¼ˆä»¥xrunä¸ºä¾‹ï¼‰

**æ‰§è¡Œæµç¨‹**:
```makefile
# ä»¿çœŸå™¨å¯æ‰§è¡Œæ–‡ä»¶å®šä¹‰
XRUN = $(CV_SIM_PREFIX) xrun
SIMVISION = $(CV_TOOL_PREFIX) simvision

# ç¼–è¯‘æ ‡å¿—
XRUN_COMP_FLAGS ?= -64bit \
                   -disable_sem2009 \
                   -access +rwc \
                   -sv \
                   -uvm \
                   -uvmhome $(XRUN_UVMHOME_ARG) \
                   $(TIMESCALE) \
                   $(SV_CMP_FLAGS)

# è¿è¡Œæ ‡å¿—
XRUN_RUN_BASE_FLAGS ?= -64bit $(XRUN_GUI) \
                       +UVM_VERBOSITY=$(XRUN_UVM_VERBOSITY) \
                       -svseed $(RNDSEED)
```

**ç›®çš„**:
- å®šä¹‰ä»¿çœŸå™¨ç‰¹å®šçš„ç¼–è¯‘å’Œè¿è¡Œå‚æ•°
- é…ç½®SystemVerilogå’ŒUVMæ”¯æŒ
- è®¾ç½®è°ƒè¯•å’Œæ³¢å½¢ç”Ÿæˆé€‰é¡¹

### ç¬¬4æ­¥ï¼šæµ‹è¯•é…ç½®ç³»ç»Ÿæ·±åº¦è§£æ ğŸ“Š

> ğŸ’¡ **ç±»æ¯”ç†è§£**: æµ‹è¯•é…ç½®å°±åƒæ˜¯èœè°±å’Œçƒ¹é¥ªæŒ‡å—â€”â€”å‘Šè¯‰å¨å¸ˆ(æµ‹è¯•å°)è¦åšä»€ä¹ˆèœ(æµ‹è¯•)ï¼Œç”¨ä»€ä¹ˆææ–™(ç¨‹åº)ï¼Œæ€ä¹ˆåš(å‚æ•°)ã€‚

#### 4.1 æµ‹è¯•ç¨‹åºé…ç½®æ–‡ä»¶
**ä½ç½®**: `cv32e40p/tests/programs/custom/hello-world/test.yaml`

```yaml
# ğŸ“› æµ‹è¯•åŸºæœ¬ä¿¡æ¯
name: hello-world                           # æµ‹è¯•åç§°(å¿…é¡»ä¸ç›®å½•åä¸€è‡´)
uvm_test: uvmt_cv32e40p_firmware_test_c     # UVMæµ‹è¯•ç±»åç§°
description: >                             # æµ‹è¯•æè¿°
    Simple hello-world sanity test         # åŸºç¡€åŠŸèƒ½æ€§æµ‹è¯•
```

#### 4.2 å…¨å±€é…ç½®ç³»ç»Ÿ ğŸŒ
**ä½ç½®**: `cv32e40p/tests/cfg/default.yaml`

```yaml
# ğŸ”§ ç¼–è¯‘å™¨é…ç½® - å‘Šè¯‰SystemVerilogç¼–è¯‘å™¨å¦‚ä½•ç¼–è¯‘RTL
name: default                               # é…ç½®åç§°
description: Default configuration for CV32E40P simulations
compile_flags:                              # SystemVerilogç¼–è¯‘æ ‡å¿— 
    +define+NO_PULP                         # ç¦ç”¨PULPæ‰©å±•æŒ‡ä»¤é›†

# ğŸ¯ OVPå‚è€ƒæ¨¡å‹é…ç½® - å‘Šè¯‰"æ ‡å‡†ç­”æ¡ˆ"å¦‚ä½•è¡¨ç°
ovpsim: >                                   # å¤šè¡Œå­—ç¬¦ä¸²
    --override root/cpu/misa_Extensions=0x001104  # RISC-V ISAæ‰©å±•é…ç½®
    --override root/cpu/marchid=4               # æ¶æ„ID(æ ‡è¯†CV32E40P)
    --override root/cpu/noinhibit_mask=0xFFFFFFF0  # ä¸å¯ç¦æ­¢çš„ä¸­æ–­æ©ç 
#    --trace --tracechange --traceshowicount --monitornets  # è°ƒè¯•é€‰é¡¹(å·²æ³¨é‡Š)

# ğŸ”¨ Cç¼–è¯‘å™¨é…ç½® - å‘Šè¯‰GCCå¦‚ä½•ç¼–è¯‘Cç¨‹åº  
cflags: >                                   # Cç¼–è¯‘å‚æ•°
    -DNO_PULP                               # å®šä¹‰NO_PULPå®ï¼Œç¦ç”¨PULPç‰¹æ€§
```

#### 4.3 Makefileé…ç½®å¤„ç†æœºåˆ¶ âš™ï¸
```makefile
# ğŸ“ æµ‹è¯•ç¨‹åºå˜é‡è§£æ
TEST_PROGRAM ?= $(TEST)                     # hello-world
TEST_NAME = $(TEST)                        # hello-world 
TEST_UVM_TEST = uvmt_cv32e40p_firmware_test_c  # ä»test.yamlè§£æå¾—å‡º

# ğŸŒ å…¨å±€é…ç½®è§£æ (CFG=default æ—¶)
CFG_COMPILE_FLAGS = +define+NO_PULP         # SystemVerilogç¼–è¯‘æ ‡å¿—
CFG_CFLAGS = -DNO_PULP                     # Cç¼–è¯‘æ ‡å¿—
CFG_OVPSIM = --override root/cpu/misa_Extensions=0x001104 --override root/cpu/marchid=4 --override root/cpu/noinhibit_mask=0xFFFFFFF0

# ğŸ“ ç»“æœç›®å½•ç”Ÿæˆ
SIM_TEST_RESULTS = $(SIM_CFG_RESULTS)/$(TEST)  # xrun_results/default/hello-world
SIM_RUN_RESULTS = $(SIM_TEST_RESULTS)/$(RUN_INDEX) # .../hello-world/0
```

**é…ç½®ç³»ç»Ÿçš„å¼ºå¤§åŠŸèƒ½**:
- âœ… **å¤šé…ç½®æ”¯æŒ**: å¯ä»¥åŒæ—¶ç»´æŠ¤no_pulp.yamlã€pulp.yamlç­‰å¤šå¥—é…ç½®
- âœ… **å±‚æ¬¡åŒ–é…ç½®**: å…¨å±€é…ç½® + æµ‹è¯•ç‰¹å®šé…ç½®çš„ç»„åˆ
- âœ… **å‚æ•°ä¼ é€’**: ä» YAML â†’ Makefile â†’ ä»¿çœŸå™¨ â†’ Cç¼–è¯‘å™¨çš„å®Œæ•´é“¾è·¯
- âœ… **çµæ´»æ‰©å±•**: æ–°å¢æµ‹è¯•åªéœ€æ·»åŠ ç›®å½•å’Œtest.yaml

### ç¬¬5æ­¥ï¼šä¾èµ–é¡¹æ£€æŸ¥å’Œæ„å»º

**ä¸»è¦ä¾èµ–é¡¹**:
1. `$(XRUN_SIM_PREREQ)` â†’ `comp` ï¼ˆç¼–è¯‘ï¼‰
2. `hex` ï¼ˆç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰
3. `gen_ovpsim_ic` ï¼ˆOVPä»¿çœŸå™¨é…ç½®ï¼‰

#### 5.1 RTLç¼–è¯‘ (compç›®æ ‡)

**ä½ç½®**: `mk/uvmt/xrun.mk:297`

**æ‰§è¡Œæµç¨‹**:
```makefile
comp: mk_xrun_dir $(CV_CORE_PKG) $(SVLIB_PKG)
	@echo "$(BANNER)"
	@echo "* Compiling xrun in $(SIM_CFG_RESULTS)"
	@echo "$(BANNER)"
	cd $(SIM_CFG_RESULTS) && $(XRUN) \
		$(XRUN_COMP) \
		$(XRUN_ELAB_COV_FLAGS) \
		-top $(RTLSRC_VLOG_TB_TOP) \
		-l xrun.log \
		-elaborate
```

**è¯¦ç»†è¿‡ç¨‹**:
1. **åˆ›å»ºä»¿çœŸç›®å½•**: `mk_xrun_dir`åˆ›å»ºå¿…è¦çš„ä»¿çœŸå·¥ä½œç›®å½•
2. **æ£€æŸ¥RTLä¾èµ–**: ç¡®ä¿CV32E40P RTLä»£ç å·²å…‹éš†åˆ°`$(CV_CORE_PKG)`
3. **ç¼–è¯‘SystemVerilog**: 
   - åŒ…å«RTLæºç æ–‡ä»¶ï¼ˆæ¥è‡ª`cv32e40p/rtl/`ï¼‰
   - åŒ…å«æµ‹è¯•å°æ–‡ä»¶ï¼ˆæ¥è‡ª`cv32e40p/tb/uvmt/`ï¼‰
   - ç¼–è¯‘UVMåº“å’Œè‡ªå®šä¹‰éªŒè¯ç»„ä»¶
4. **é¡¶å±‚æ¨¡å—**: ä»¥`uvmt_cv32e40p_tb`ä½œä¸ºé¡¶å±‚æµ‹è¯•å°

**æ¶‰åŠçš„ä¸»è¦SystemVerilogæ–‡ä»¶**:
- `uvmt_cv32e40p_tb.sv`: é¡¶å±‚æµ‹è¯•å°æ¨¡å—
- `uvmt_cv32e40p_dut_wrap.sv`: è®¾è®¡åŒ…è£…å™¨
- `uvmt_cv32e40p_pkg.sv`: UVMåŒ…å®šä¹‰

#### 5.2 è½¯ä»¶ç¨‹åºç¼–è¯‘ (hexç›®æ ‡)

**ä½ç½®**: `mk/Common.mk:507`

**æ‰§è¡Œæµç¨‹**:
```makefile
hex: $(SIM_TEST_PROGRAM_RESULTS)/$(TEST_PROGRAM)$(OPT_RUN_INDEX_SUFFIX).hex

# å®é™…çš„ç¼–è¯‘è§„åˆ™ï¼ˆé€šè¿‡åç¼€è§„åˆ™å®šä¹‰ï¼‰
%.elf: %.c
	$(RISCV_EXE_PREFIX)gcc $(RISCV_CFLAGS) \
		-march=$(RISCV_MARCH) -mabi=$(RISCV_MABI) \
		-o $@ $< $(BSP_OBJS) \
		-T $(LINKER_SCRIPT)

%.hex: %.elf
	$(RISCV_EXE_PREFIX)objcopy -O verilog $< $@
```

**è¯¦ç»†è¿‡ç¨‹**:
1. **ç¼–è¯‘Cç¨‹åº**: 
   - ä½¿ç”¨RISC-V GCCç¼–è¯‘`hello-world.c`
   - é“¾æ¥Board Support Package (BSP)
   - åº”ç”¨ç‰¹å®šçš„é“¾æ¥è„šæœ¬
2. **ç”ŸæˆELFæ–‡ä»¶**: åŒ…å«è°ƒè¯•ä¿¡æ¯çš„å¯æ‰§è¡Œæ–‡ä»¶
3. **è½¬æ¢ä¸ºHEX**: ç”ŸæˆVerilogå¯è¯»çš„åå…­è¿›åˆ¶æ ¼å¼
4. **ç”Ÿæˆå…¶ä»–æ ¼å¼**: 
   - `.nm`: ç¬¦å·è¡¨æ–‡ä»¶
   - `.itb`: æŒ‡ä»¤è·Ÿè¸ªæ–‡ä»¶

**æ¶‰åŠçš„æ–‡ä»¶**:
- `hello-world.c`: Cæºç¨‹åº
- BSPæ–‡ä»¶: å¯åŠ¨ä»£ç å’Œç¡¬ä»¶æŠ½è±¡å±‚
- é“¾æ¥è„šæœ¬: å®šä¹‰å†…å­˜å¸ƒå±€

#### 5.3 OVPä»¿çœŸå™¨é…ç½® (gen_ovpsim_icç›®æ ‡)

**ä½ç½®**: `mk/uvmt/xrun.mk:347`

**æ‰§è¡Œæµç¨‹**:
```makefile
gen_ovpsim_ic:
	@rm -f $(SIM_CFG_RESULTS)/$(TEST_NAME)/$(RUN_INDEX)/ovpsim.ic
	@mkdir -p $(SIM_CFG_RESULTS)/$(TEST_NAME)/$(RUN_INDEX)
	@touch -f $(SIM_CFG_RESULTS)/$(TEST_NAME)/$(RUN_INDEX)/ovpsim.ic
	@if [ ! -z "$(CFG_OVPSIM)" ]; then \
		echo "$(CFG_OVPSIM)" > $(SIM_CFG_RESULTS)/$(TEST_NAME)/$(RUN_INDEX)/ovpsim.ic; \
	fi
```

**ç›®çš„**:
- ä¸ºOVP (Open Virtual Platform) å‚è€ƒæ¨¡å‹åˆ›å»ºé…ç½®æ–‡ä»¶
- OVPæ¨¡å‹ç”¨ä½œ"é‡‘æ ‡å‡†"ä¸RTLè¿›è¡Œæ¯”è¾ƒ
- é…ç½®æ–‡ä»¶åŒ…å«å¤„ç†å™¨ç‰¹æ€§å’Œä»¿çœŸå‚æ•°

### ç¬¬6æ­¥ï¼šUVMæµ‹è¯•æ‰§è¡Œ

**ä½ç½®**: `mk/uvmt/xrun.mk:359`

**ä¸»è¦æ‰§è¡Œå‘½ä»¤**:
```bash
cd $(SIM_RUN_RESULTS) && $(XRUN) \
    -R -xmlibdirname ../../xcelium.d \
    -l xrun-$(TEST_NAME).log \
    $(XRUN_COMP_RUN) \
    $(XRUN_RUN_WAVES_FLAGS) \
    -covtest $(TEST_NAME) \
    $(CFG_PLUSARGS) \
    $(TEST_PLUSARGS) \
    +UVM_TESTNAME=$(TEST_UVM_TEST) \
    +elf_file=$(SIM_TEST_PROGRAM_RESULTS)/$(TEST_PROGRAM)$(OPT_RUN_INDEX_SUFFIX).elf \
    +firmware=$(SIM_TEST_PROGRAM_RESULTS)/$(TEST_PROGRAM)$(OPT_RUN_INDEX_SUFFIX).hex \
    +itb_file=$(SIM_TEST_PROGRAM_RESULTS)/$(TEST_PROGRAM)$(OPT_RUN_INDEX_SUFFIX).itb \
    +nm_file=$(SIM_TEST_PROGRAM_RESULTS)/$(TEST_PROGRAM)$(OPT_RUN_INDEX_SUFFIX).nm
```

**å‚æ•°è¯¦è§£**:

1. **`-R`**: è¿è¡Œä¹‹å‰ç¼–è¯‘å¥½çš„ä»¿çœŸå¿«ç…§
2. **`-xmlibdirname`**: æŒ‡å®šç¼–è¯‘åº“ç›®å½•
3. **`-l xrun-hello-world.log`**: æŒ‡å®šæ—¥å¿—æ–‡ä»¶
4. **`+UVM_TESTNAME=uvmt_cv32e40p_firmware_test_c`**: æŒ‡å®šè¦è¿è¡Œçš„UVMæµ‹è¯•ç±»
5. **`+elf_file=...`**: ä¼ é€’ELFæ–‡ä»¶è·¯å¾„ç»™æµ‹è¯•å°
6. **`+firmware=...`**: ä¼ é€’HEXæ–‡ä»¶è·¯å¾„ç»™æµ‹è¯•å°

### ç¬¬7æ­¥ï¼šUVMæµ‹è¯•å°åˆå§‹åŒ–

**ä½ç½®**: `cv32e40p/tb/uvmt/uvmt_cv32e40p_tb.sv`

**æ‰§è¡Œæµç¨‹**:

#### 7.1 æµ‹è¯•å°æ¨¡å—å®ä¾‹åŒ– ğŸ­

> ğŸ’¡ **ç±»æ¯”ç†è§£**: è¿™é‡Œå°±åƒæ­å»ºä¸€ä¸ªå®Œæ•´çš„æ±½è½¦æµ‹è¯•å°â€”â€”æœ‰è¢«æµ‹è½¦è¾†ã€æ¨¡æ‹Ÿå™¨ã€ä¼ æ„Ÿå™¨å’Œæ§åˆ¶ç³»ç»Ÿã€‚

```systemverilog
module uvmt_cv32e40p_tb;
    // ğŸ”„ æ—¶é’Ÿå’Œå¤ä½æ§åˆ¶æ¥å£ - ç›¸å½“äºç”µæºç³»ç»Ÿ
    uvma_clknrst_if     clknrst_if();          // ä¸»æ—¶é’Ÿå’Œå¤ä½ä¿¡å·
    uvma_clknrst_if     clknrst_if_iss();      // ISS(å‚è€ƒæ¨¡å‹)ä¸“ç”¨æ—¶é’Ÿ
    
    // ğŸ¯ è¢«æµ‹è®¾è®¡(DUT)çš„å…³é”®æ¥å£ - ç›¸å½“äºæ±½è½¦çš„å„ç§æ¥å£
    uvma_debug_if       debug_if();            // è°ƒè¯•æ¥å£(ç›¸å½“äºOBDæ¥å£)
    uvma_interrupt_if   interrupt_if();        // ä¸­æ–­æ¥å£(ç›¸å½“äºç´§æ€¥ä¿¡å·)
    
    // ğŸ“¦ å†…å­˜æ€»çº¿æ¥å£ - æ•°æ®å’ŒæŒ‡ä»¤çš„ä¼ è¾“é€šé“
    uvma_obi_memory_if  obi_memory_instr_if(.clk(clknrst_if.clk),
                                            .reset_n(clknrst_if.reset_n)); // æŒ‡ä»¤è·å–æ€»çº¿
    uvma_obi_memory_if  obi_memory_data_if (.clk(clknrst_if.clk), 
                                            .reset_n(clknrst_if.reset_n));  // æ•°æ®è®¿é—®æ€»çº¿
    
    // ğŸ­ DUTåŒ…è£…å™¨å®ä¾‹åŒ– - ç›¸å½“äºæ±½è½¦æœ¬èº«
    uvmt_cv32e40p_dut_wrap  dut_wrap(
        .clknrst_if(clknrst_if),              // ç”µæºè¿æ¥  
        .obi_memory_instr_if(obi_memory_instr_if), // æŒ‡ä»¤å­˜å‚¨å™¨è¿æ¥
        .obi_memory_data_if(obi_memory_data_if),   // æ•°æ®å­˜å‚¨å™¨è¿æ¥
        .debug_if(debug_if),                  // è°ƒè¯•ç«¯å£
        .interrupt_if(interrupt_if)           // ä¸­æ–­ä¿¡å·
    );
    
    // ğŸ† å‚è€ƒæ¨¡å‹(ISS)å®ä¾‹åŒ– - ç›¸å½“äºæ ‡å‡†æ ·è½¦
    uvmt_cv32e40p_iss_wrap  iss_wrap(
        .clknrst_if(clknrst_if_iss),         // ç‹¬ç«‹çš„æ—¶é’ŸåŸŸ
        .obi_memory_instr_if(obi_memory_instr_if), // åŒæ­¥æŒ‡ä»¤è®¿é—®
        .obi_memory_data_if(obi_memory_data_if)    // åŒæ­¥æ•°æ®è®¿é—®
    );
    
    // ğŸ“Š çŠ¶æ€ç›‘æ§æ¥å£ - ç›¸å½“äºä»ªè¡¨ç›˜
    uvmt_cv32e40p_vp_status_if vp_status_if(
        .tests_passed(tp),    // æµ‹è¯•é€šè¿‡æŒ‡ç¤ºç¯ ğŸŸ¢
        .tests_failed(tf),    // æµ‹è¯•å¤±è´¥æŒ‡ç¤ºç¯ ğŸ”´  
        .exit_valid(evalid),  // ç¨‹åºç»“æŸä¿¡å· 
        .exit_value(evalue)   // é€€å‡ºç (æˆåŠŸ=0, å¤±è´¥!=0)
    );
```

**å…³é”®æŠ€æœ¯ç‚¹è§£é‡Š**:
- **OBIæ€»çº¿**: OpenHWç»„ç»‡å®šä¹‰çš„å¼€æ”¾æ€»çº¿æ¥å£ï¼Œç±»ä¼¼ARMçš„AHBæ€»çº¿
- **ISSæ¨¡å‹**: Instruction Set Simulatorï¼Œæä¾›æŒ‡ä»¤çº§çš„å‚è€ƒå®ç°  
- **Virtual Peripheral**: è™šæ‹Ÿå¤–è®¾ï¼Œç”¨äºæµ‹è¯•ç¨‹åºå’Œæµ‹è¯•å°çš„é€šä¿¡

#### 7.2 UVMç¯å¢ƒåˆå§‹åŒ– ğŸ†

> ğŸ’¡ **ç±»æ¯”ç†è§£**: è¿™ä¸ªè¿‡ç¨‹å°±åƒæ˜¯ç”µå½±å¯¼æ¼”åœ¨å¼€æ‹å‰çš„å‡†å¤‡å·¥ä½œâ€”â€”æŠŠæ‰€æœ‰é“å…·ã€æ¼”å‘˜ã€åœ°ç‚¹éƒ½è®°å½•åœ¨å†Œï¼Œç„¶åå–Šâ€œAction!â€å¼€å§‹æ‹æ‘„ã€‚

```systemverilog
initial begin
    // ğŸ“ UVMé…ç½®æ•°æ®åº“æ³¨å†Œ - ç›¸å½“äºç”µå½±é“å…·åº“
    // æ³¨å†ŒæŒ‡ä»¤æ€»çº¿æ¥å£ï¼Œè®©UVM Agentèƒ½æ‰¾åˆ°å®ƒ
    uvm_config_db#(virtual uvma_obi_memory_if)::set(
        null,                           // ä»æ ¹èŠ‚ç‚¹å¼€å§‹
        "*.env.*instr*agent*",         // æŒ‡ä»¤Agentçš„è·¯å¾„æ¨¡å¼
        "vif",                         // æ¥å£å…³é”®å­—
        obi_memory_instr_if            // å®é™…æ¥å£å¥æŸ„
    );
    
    // æ³¨å†Œæ•°æ®æ€»çº¿æ¥å£
    uvm_config_db#(virtual uvma_obi_memory_if)::set(
        null, 
        "*.env.*data*agent*", 
        "vif", 
        obi_memory_data_if
    );
    
    // æ³¨å†Œè°ƒè¯•æ¥å£
    uvm_config_db#(virtual uvma_debug_if)::set(
        null,
        "*.env.*debug*agent*", 
        "vif", 
        debug_if
    );
    
    // æ³¨å†Œä¸­æ–­æ¥å£ 
    uvm_config_db#(virtual uvma_interrupt_if)::set(
        null,
        "*.env.*interrupt*agent*",
        "vif",
        interrupt_if
    );
    
    // ğŸ¦ å¯åŠ¨UVMæµ‹è¯• - ç›¸å½“äºå¯¼æ¼”å–Š"Action!"
    run_test();  // è¿™ä¸ªå‡½æ•°ä¼šæ ¹æ®+UVM_TESTNAMEå‚æ•°åˆ›å»ºæŒ‡å®šçš„æµ‹è¯•ç±»
end
```

**æŠ€æœ¯è¯¦è§£**:
- **uvm_config_db**: UVMçš„å…¨å±€é…ç½®æ•°æ®åº“ï¼Œç±»ä¼¼ä¸€ä¸ªå…¨å±€çš„â€œç”µè¯ç°¿â€
- **è·¯å¾„æ¨¡å¼**: `"*.env.*instr*agent*"`ç”¨é€šé…ç¬¦åŒ¹é…æ‰€æœ‰ç›¸å…³çš„Agent
- **virtual interface**: SystemVerilogçš„è™šæ‹Ÿæ¥å£ï¼Œå…è®¸ç±»å’Œæ¨¡å—ä¹‹é—´ä¼ é€’æ¥å£å¥æŸ„

### ç¬¬8æ­¥ï¼šUVMæµ‹è¯•ç±»æ‰§è¡Œ

**ä½ç½®**: UVMæµ‹è¯•åŒ…ä¸­çš„`uvmt_cv32e40p_firmware_test_c`ç±»

**æ‰§è¡Œæµç¨‹**:

#### 8.1 æ„å»ºé˜¶æ®µ (build_phase)
```systemverilog
class uvmt_cv32e40p_firmware_test_c extends uvmt_cv32e40p_base_test_c;
    
    virtual function void build_phase(uvm_phase phase);
        super.build_phase(phase);
        
        // é…ç½®æµ‹è¯•ç¯å¢ƒ
        uvm_config_db#(string)::set(null, "*", "elf_file", elf_file_path);
        uvm_config_db#(string)::set(null, "*", "firmware_file", firmware_path);
        
        // åˆ›å»ºç¯å¢ƒç»„ä»¶
        env = uvmt_cv32e40p_env_c::type_id::create("env", this);
    endfunction
```

#### 8.2 è¿è¡Œé˜¶æ®µ (run_phase)
```systemverilog
virtual task run_phase(uvm_phase phase);
    super.run_phase(phase);
    
    phase.raise_objection(this);
    
    // åŠ è½½ç¨‹åºåˆ°å†…å­˜
    load_program_to_memory();
    
    // å¯åŠ¨å¤„ç†å™¨
    start_processor();
    
    // ç­‰å¾…ç¨‹åºæ‰§è¡Œå®Œæˆ
    wait_for_completion();
    
    phase.drop_objection(this);
endtask
```

### ç¬¬9æ­¥ï¼šç¨‹åºåŠ è½½å’Œæ‰§è¡Œ

#### 9.1 å†…å­˜åŠ è½½
- **Virtual Sequencer**è¯»å–hexæ–‡ä»¶
- é€šè¿‡**Memory Agent**å°†ç¨‹åºåŠ è½½åˆ°ä»¿çœŸå†…å­˜
- è®¾ç½®ç¨‹åºè®¡æ•°å™¨åˆ°å…¥å£åœ°å€

#### 9.2 å¤„ç†å™¨å¯åŠ¨
- é‡Šæ”¾å¤ä½ä¿¡å·
- CV32E40På¼€å§‹ä»ç¨‹åºå…¥å£æ‰§è¡ŒæŒ‡ä»¤
- OVPå‚è€ƒæ¨¡å‹åŒæ­¥æ‰§è¡Œç›¸åŒç¨‹åº

#### 9.3 æŒ‡ä»¤æ‰§è¡Œç›‘æ§
- **Instruction Monitor**æ•è·æ¯æ¡æ‰§è¡Œçš„æŒ‡ä»¤
- **Data Monitor**ç›‘æ§å†…å­˜è®¿é—®
- **Step-and-Compare**æœºåˆ¶æ¯”è¾ƒRTLå’Œå‚è€ƒæ¨¡å‹çš„æ‰§è¡Œç»“æœ

### ç¬¬10æ­¥ï¼šç»“æœéªŒè¯å’ŒæŠ¥å‘Š

#### 10.1 å®æ—¶æ¯”è¾ƒ
- æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸæ¯”è¾ƒRTLå’Œå‚è€ƒæ¨¡å‹çš„çŠ¶æ€
- æ£€æŸ¥å¯„å­˜å™¨æ–‡ä»¶ã€å†…å­˜çŠ¶æ€ã€ç¨‹åºè®¡æ•°å™¨ç­‰
- å‘ç°ä¸åŒ¹é…æ—¶ç«‹å³æŠ¥å‘Šé”™è¯¯

#### 10.2 æœ€ç»ˆæ£€æŸ¥
- ç¨‹åºæ­£å¸¸ç»“æŸæ£€æŸ¥
- è¾“å‡ºç»“æœéªŒè¯ï¼ˆå¦‚hello-worldçš„æ‰“å°è¾“å‡ºï¼‰
- æ€§èƒ½è®¡æ•°å™¨æ£€æŸ¥

#### 10.3 æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
```
UVM_INFO @ 0: reporter [RNTST] Running test uvmt_cv32e40p_firmware_test_c...
UVM_INFO @ 0: uvm_test_top.env [ENV] Loading firmware: hello-world.hex
UVM_INFO @ 0: uvm_test_top.env.step_compare [STEPCMP] Starting step-and-compare
UVM_INFO @ 1000: uvm_test_top.env [ENV] Program execution started
UVM_INFO @ 5000: uvm_test_top.env [ENV] Hello World! printed to console
UVM_INFO @ 6000: uvm_test_top.env [ENV] Program execution completed successfully
UVM_INFO @ 6000: uvm_test_top.env.step_compare [STEPCMP] 1234 instructions compared, 0 mismatches
```

## æ–‡ä»¶å’Œç›®å½•è¯¦è§£

### å…³é”®SystemVerilogæ–‡ä»¶

1. **`uvmt_cv32e40p_tb.sv`**: é¡¶å±‚æµ‹è¯•å°ï¼Œè¿æ¥æ‰€æœ‰ç»„ä»¶
2. **`uvmt_cv32e40p_pkg.sv`**: åŒ…å«æ‰€æœ‰UVMç±»å®šä¹‰
3. **`uvmt_cv32e40p_dut_wrap.sv`**: DUTåŒ…è£…å™¨ï¼Œè¿æ¥æ¥å£ä¿¡å·
4. **`uvmt_cv32e40p_iss_wrap.sv`**: å‚è€ƒæ¨¡å‹åŒ…è£…å™¨

### å…³é”®è„šæœ¬å’Œå·¥å…·

1. **Makefileé“¾**: æ§åˆ¶æ•´ä¸ªæ„å»ºå’Œä»¿çœŸè¿‡ç¨‹
2. **RISC-Vå·¥å…·é“¾**: ç¼–è¯‘Cç¨‹åºä¸ºRISC-Væœºå™¨ç 
3. **Xceliumä»¿çœŸå™¨**: æ‰§è¡ŒSystemVerilogä»¿çœŸ
4. **OVPæ¨¡å‹**: æä¾›æŒ‡ä»¤çº§ç²¾ç¡®çš„å‚è€ƒæ¨¡å‹

### ç”Ÿæˆçš„è¾“å‡ºæ–‡ä»¶

1. **æ—¥å¿—æ–‡ä»¶**: `xrun-hello-world.log`
2. **æ³¢å½¢æ–‡ä»¶**: `waves.shm/` (å¦‚æœå¯ç”¨WAVES=1)
3. **è¦†ç›–ç‡æ•°æ®**: `.cov` æ–‡ä»¶ (å¦‚æœå¯ç”¨COV=1)
4. **ç¨‹åºæ–‡ä»¶**: `.elf`, `.hex`, `.nm`, `.itb`

## å¸¸è§é—®é¢˜æ’æŸ¥

### ç¯å¢ƒå˜é‡é—®é¢˜
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
make vars

# å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ
export CV_SIMULATOR=xrun    # å¿…é¡»æŒ‡å®šä»¿çœŸå™¨
export CV_CORE=cv32e40p     # å¿…é¡»æŒ‡å®šæ ¸å¿ƒç±»å‹
```

### ç¼–è¯‘é—®é¢˜
```bash
# æ¸…ç†é‡æ–°ç¼–è¯‘
make clean_all
make comp

# æŸ¥çœ‹ç¼–è¯‘æ—¥å¿—
cat xcelium.d/xrun.log
```

### ä»¿çœŸé—®é¢˜
```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼
make test TEST=hello-world GUI=1

# æŸ¥çœ‹è¯¦ç»†UVMæ—¥å¿—
make test TEST=hello-world USER_RUN_FLAGS=+UVM_VERBOSITY=UVM_DEBUG
```

## æ‰©å±•é˜…è¯»

1. **UVMç”¨æˆ·æŒ‡å—**: äº†è§£UVMæµ‹è¯•å°æ¶æ„
2. **CV32E40Pè§„æ ¼ä¹¦**: äº†è§£å¤„ç†å™¨ç‰¹æ€§
3. **SystemVerilogè¯­è¨€æ‰‹å†Œ**: ç†è§£æµ‹è¯•å°å®ç°
4. **RISC-VæŒ‡ä»¤é›†æ‰‹å†Œ**: ç†è§£å¤„ç†å™¨è¡Œä¸º

è¿™ä¸ªè¯¦ç»†çš„æ‰§è¡Œæµç¨‹è¯´æ˜äº†ä»ç®€å•çš„`make test TEST=hello-world`å‘½ä»¤å¼€å§‹ï¼Œæ•´ä¸ªå¤æ‚çš„éªŒè¯ç³»ç»Ÿæ˜¯å¦‚ä½•åè°ƒå·¥ä½œçš„ï¼ŒåŒ…æ‹¬Makefileç³»ç»Ÿã€è½¯ä»¶ç¼–è¯‘ã€ç¡¬ä»¶ä»¿çœŸã€UVMéªŒè¯ç¯å¢ƒä»¥åŠç»“æœéªŒè¯ç­‰å„ä¸ªæ–¹é¢ã€‚